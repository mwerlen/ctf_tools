from tools.rsa_functions import *
from tools.conversions import *

"""
Sample data from pucoCTF2017
c= 95272795986475189505518980251137003509292621140166383887854853863720692420204142448424074834657149326853553097626486371206617513769930277580823116437975487148956107509247564965652417450550680181691869432067892028368985007229633943149091684419834136214793476910417359537696632874045272326665036717324623992885
p= 11387480584909854985125335848240384226653929942757756384489381242206157197986555243995335158328781970310603060671486688856263776452654268043936036556215243
q= 12972222875218086547425818961477257915105515705982283726851833508079600460542479267972050216838604649742870515200462359007315431848784163790312424462439629
dp= 8191957726161111880866028229950166742224147653136894248088678244548815086744810656765529876284622829884409590596114090872889522887052772791407131880103961
dq= 3570695757580148093370242608506191464756425954703930236924583065811730548932270595568088372441809535917032142349986828862994856575730078580414026791444659
"""

'''
    Key Definition
'''
print('-'*16)
print("Key definition")
print('-'*16)


p = 137
print("p : " + str(p))

q = 131
print("q : " + str(q))

dp = 91
print("dp : " + str(dp))

dq = 87
print("dq : " + str(dq))

n = p*q
print("n : " + str(n))

phiN = (p-1)*(q-1)
print("phiN : " + str(phiN))

qInv = multiplicative_inverse(q,p)    
print("qInv : " + str(qInv))


'''
  Cipher
'''
print
print('-'*16)
print("Cipher")
print('-'*16)

c = 13656
print("c : " + str(c))


'''
    Decryption
'''
print
print('-'*16)
print("Decryption")
print('-'*16)

m1 = pow(c, dp, p)
print("m1 : " + str(m1))

m2 = pow(c, dq, q)
print("m2 : " + str(m2))

h = qInv * ( m1 + p - m2 ) % p
print("h : " + str(h))

m = m2 + (h * q)
print("m : " + str(m))

print
print("Message (decimal) : "+str(m))
print("Message (hex) : "+int2Hex(m))
print("Message : "+int2Text(m))
